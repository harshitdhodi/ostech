import{r as a,R as O,P as V,j as s,b as g,Q as X}from"./index-DaCCig_H.js";import{l as L,L as $,s as B}from"./server.browser-B6uHIyw_.js";function M(n,t){const e=a.useRef(t);a.useEffect(function(){t!==e.current&&n.attributionControl!=null&&(e.current!=null&&n.attributionControl.removeAttribution(e.current),t!=null&&n.attributionControl.addAttribution(t)),e.current=t},[n,t])}const Q=1;function q(n){return Object.freeze({__version:Q,map:n})}function J(n,t){return Object.freeze({...n,...t})}const T=a.createContext(null),z=T.Provider;function R(){const n=a.useContext(T);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function K(n){function t(e,r){const{instance:o,context:l}=n(e).current;return a.useImperativeHandle(r,()=>o),e.children==null?null:O.createElement(z,{value:l},e.children)}return a.forwardRef(t)}function Y(n){function t(e,r){const[o,l]=a.useState(!1),{instance:u}=n(e,l).current;a.useImperativeHandle(r,()=>u),a.useEffect(function(){o&&u.update()},[u,o,e.children]);const f=u._contentNode;return f?V.createPortal(e.children,f):null}return a.forwardRef(t)}function ee(n){function t(e,r){const{instance:o}=n(e).current;return a.useImperativeHandle(r,()=>o),null}return a.forwardRef(t)}function H(n,t){const e=a.useRef();a.useEffect(function(){return t!=null&&n.instance.on(t),e.current=t,function(){e.current!=null&&n.instance.off(e.current),e.current=null}},[n,t])}function S(n,t){const e=n.pane??t.pane;return e?{...n,pane:e}:n}function te(n,t){return function(r,o){const l=R(),u=n(S(r,l),l);return M(l.map,r.attribution),H(u.current,r.eventHandlers),t(u.current,l,r,o),u}}function I(n,t,e){return Object.freeze({instance:n,context:t,container:e})}function P(n,t){return t==null?function(r,o){const l=a.useRef();return l.current||(l.current=n(r,o)),l}:function(r,o){const l=a.useRef();l.current||(l.current=n(r,o));const u=a.useRef(r),{instance:f}=l.current;return a.useEffect(function(){u.current!==r&&(t(f,r,u.current),u.current=r)},[f,r,o]),l}}function ne(n,t){a.useEffect(function(){return(t.layerContainer??t.map).addLayer(n.instance),function(){var l;(l=t.layerContainer)==null||l.removeLayer(n.instance),t.map.removeLayer(n.instance)}},[t,n])}function D(n){return function(e){const r=R(),o=n(S(e,r),r);return M(r.map,e.attribution),H(o.current,e.eventHandlers),ne(o.current,r),o}}function re(n,t){const e=P(n,t),r=D(e);return K(r)}function oe(n,t){const e=P(n),r=te(e,t);return Y(r)}function ae(n,t){const e=P(n,t),r=D(e);return ee(r)}function ce(n,t,e){const{opacity:r,zIndex:o}=t;r!=null&&r!==e.opacity&&n.setOpacity(r),o!=null&&o!==e.zIndex&&n.setZIndex(o)}function se(){return R().map}function le(n){const t=se();return a.useEffect(function(){return t.on(n),function(){t.off(n)}},[t,n]),t}function N(){return N=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n},N.apply(this,arguments)}function ue({bounds:n,boundsOptions:t,center:e,children:r,className:o,id:l,placeholder:u,style:f,whenReady:m,zoom:p,...h},v){const[C]=a.useState({className:o,id:l,style:f}),[d,x]=a.useState(null);a.useImperativeHandle(v,()=>(d==null?void 0:d.map)??null,[d]);const j=a.useCallback(w=>{if(w!==null&&d===null){const y=new L.Map(w,h);e!=null&&p!=null?y.setView(e,p):n!=null&&y.fitBounds(n,t),m!=null&&y.whenReady(m),x(q(y))}},[]);a.useEffect(()=>()=>{d==null||d.map.remove()},[d]);const E=d?O.createElement(z,{value:d},r):u??null;return O.createElement("div",N({},C,{ref:j}),E)}const ie=a.forwardRef(ue),fe=re(function({position:t,...e},r){const o=new L.Marker(t,e);return I(o,J(r,{overlayContainer:o}))},function(t,e,r){e.position!==r.position&&t.setLatLng(e.position),e.icon!=null&&e.icon!==r.icon&&t.setIcon(e.icon),e.zIndexOffset!=null&&e.zIndexOffset!==r.zIndexOffset&&t.setZIndexOffset(e.zIndexOffset),e.opacity!=null&&e.opacity!==r.opacity&&t.setOpacity(e.opacity),t.dragging!=null&&e.draggable!==r.draggable&&(e.draggable===!0?t.dragging.enable():t.dragging.disable())}),de=oe(function(t,e){const r=new L.Popup(t,e.overlayContainer);return I(r,e)},function(t,e,{position:r},o){a.useEffect(function(){const{instance:u}=t;function f(p){p.popup===u&&(u.update(),o(!0))}function m(p){p.popup===u&&o(!1)}return e.map.on({popupopen:f,popupclose:m}),e.overlayContainer==null?(r!=null&&u.setLatLng(r),u.openOn(e.map)):e.overlayContainer.bindPopup(u),function(){var h;e.map.off({popupopen:f,popupclose:m}),(h=e.overlayContainer)==null||h.unbindPopup(),e.map.removeLayer(u)}},[t,e,o,r])}),pe=ae(function({url:t,...e},r){const o=new L.TileLayer(t,S(e,r));return I(o,r)},function(t,e,r){ce(t,e,r);const{url:o}=e;o!=null&&o!==r.url&&t.setUrl(o)}),ye=()=>{const n=c=>$.divIcon({html:B.renderToString(c),iconSize:[32,32],className:""}),[t,e]=a.useState([]),[r,o]=a.useState(null),[l,u]=a.useState([]),[f,m]=a.useState(""),[p,h]=a.useState(null),[v,C]=a.useState(""),[d,x]=a.useState(""),[j,E]=a.useState([]),[w,y]=a.useState(!1),k=[40.7128,-74.006];a.useEffect(()=>{(async()=>{try{const i=await g.get("/api/globalpresence/countries");e(i.data);const b=i.data.map(Z=>Z.name);E(b)}catch(i){console.error("Error fetching countries:",i)}})()},[]),a.useEffect(()=>{(async()=>{try{const i=await g.get("/api/globalpresence/globalPresenceEntries");u(i.data)}catch(i){console.error("Error fetching logos:",i)}})()},[]);const A=c=>{const i=c.target.files[0];h(i)},_=async()=>{const c=new FormData;c.append("country",r.name),c.append("description",v),c.append("photo",p),c.append("alt",d);try{await g.post("/api/globalpresence/addGlobalPresence",c,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}),h(null),C(""),x("");const i=await g.get("/api/globalpresence/globalPresenceEntries");u(i.data)}catch(i){console.error("Error adding logo:",i)}},G=()=>{h(null)},F=c=>{const i=t.find(b=>b.name===c);o(i)},U=async c=>{try{await g.delete(`/api/globalpresence/deleteGlobalPresence?id=${c}`,{withCredentials:!0}),u(l.filter(i=>i._id!==c))}catch(i){console.error("Error deleting logo:",i)}};t.filter(c=>c.name.toLowerCase().includes(f.toLowerCase()));const W=()=>(le({click:()=>{y(!0)},dblclick:()=>{y(!0)}}),null);return s.jsxs("div",{className:"container mx-auto p-4",children:[s.jsx("h1",{className:"text-xl font-bold  text-gray-700 font-serif uppercase mb-4",children:"Global Presence"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("input",{list:"countries",type:"text",placeholder:"Search Country",value:f,onChange:c=>{m(c.target.value),F(c.target.value)},className:"w-full p-2 border border-gray-300 rounded mb-2"}),s.jsx("datalist",{id:"countries",children:j.map((c,i)=>s.jsx("option",{value:c},i))})]}),f&&s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("label",{htmlFor:"photo",className:"block font-semibold mb-2",children:"Photo"}),s.jsx("input",{type:"file",name:"photo",id:"photo",onChange:A,className:"border rounded focus:outline-none",accept:"image/*"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"alt",className:"block font-semibold mb-2",children:"Alternative Text"}),s.jsx("input",{type:"text",id:"alt",value:d,onChange:c=>x(c.target.value),className:"w-full p-2 border rounded focus:outline-none"})]}),p&&s.jsxs("div",{className:"mt-2 w-56 relative group",children:[s.jsx("img",{src:URL.createObjectURL(p),alt:"Gallery",className:"h-32 w-56 object-cover"}),s.jsx("button",{type:"button",onClick:G,className:"absolute top-4 right-2 bg-red-500 text-white rounded-md p-1 size-6 flex items-center justify-center hover:bg-red-600 focus:outline-none",children:"X"})]})]}),s.jsx("input",{type:"text",placeholder:"Description",value:v,onChange:c=>C(c.target.value),className:"w-full p-2 border border-gray-300 rounded mb-2"}),s.jsx("button",{onClick:_,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"Add Logo"})]}),s.jsxs(ie,{style:{height:"500px",width:"100%"},center:k,scrollWheelZoom:!1,zoom:3,className:"mb-4",children:[s.jsx(pe,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",noWrap:!0}),l.map(c=>{const i=t.find(b=>b.name===c.country);return i&&s.jsxs(fe,{position:i.latlng,icon:n(s.jsx(X,{size:32,color:"red"})),children:[s.jsxs(de,{minWidth:100,children:[s.jsx("img",{src:`/api/logo/download/${c.photo}`,alt:c.alt,className:"w-24 h-18"}),s.jsx("p",{className:"font-semibold font-serif",children:c.country}),s.jsx("p",{children:c.description}),s.jsx("button",{onClick:()=>U(c._id),className:"mt-2 bg-red-500 text-white p-1 rounded hover:bg-red-600",children:"Delete Marker"})]}),s.jsx(W,{})]},c._id)})]})]})};export{ye as default};
